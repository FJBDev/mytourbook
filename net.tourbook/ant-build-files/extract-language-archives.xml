<?xml version="1.0" encoding="UTF-8"?>

<project name="create-translation-file" default="unzip-all-archives" basedir="..">

	<!--
		extract language files from the archive
	-->

	<property name="mt-trunk" value=".." />
	<property name="language-fragments" value="${mt-trunk}/language-fragments" />

	<property name="dir-with-language-archive" value="${mt-trunk}/../mytourbook-LANGUAGE-archives" />
	<property name="temp-unzip-dir" value="${mt-trunk}/../ant-temp-unzip" />

	<!--
		DEFAULT target
	-->
	<target name="unzip-all-archives">

		<!-- create temp dir 
		<echo message="create temp dir: ${temp-unzip-dir}" />
		-->
		<mkdir dir="${temp-unzip-dir}" />


		<!-- unzip archive: FR -->
		<antcall target="unzip-archive-for-one-language">
			<param name="archive-language" value="fr" />
		</antcall>

		<!-- unzip archive: NL -->
		<antcall target="unzip-archive-for-one-language">
			<param name="archive-language" value="nl" />
		</antcall>


		<!-- delete temp dir 
		<echo message="delete temp dir: ${temp-unzip-dir}" />
		-->
		<delete dir="${temp-unzip-dir}" />

	</target>

	<!--
		DEBUG target
	-->
	<target name="debug">


	</target>


	<target name="unzip-archive-for-one-language">

		<!-- delete temp dir content -->
		<echo message="delete temp dir content: ${temp-unzip-dir}" />
		<delete includeemptydirs="true">
			<fileset dir="${temp-unzip-dir}" includes="**/*" />
		</delete>


		<!--
		<echo message="expand archive into ${temp-unzip-dir}" />
		-->
		<unzip dest="${temp-unzip-dir}">

			<patternset includes="**/*${archive-language}.properties" />

			<!-- using fileset to ignore missing archives -->
			<fileset dir="${dir-with-language-archive}/import">
				<include name="mt-${archive-language}.zip" />
				<exclude name="exclude" />
			</fileset>
		</unzip>

		<!--
		<echo message="copy archive into the project plugins />
		-->
		<copy todir="${mt-trunk}" overwrite="true" verbose="false">

			<fileset dir="${temp-unzip-dir}" includes="**/*">
				<!-- ignore empty files -->
				<size value="0" when="more" />
			</fileset>

			<mapper>
				<regexpmapper from="^(.*)\\src\\de\.byteholder(.*)$$" to="\\de\.byteholder\2" />
				<regexpmapper from="^(.*)\\src\\net\.tourbook(.*)$$" to="\\net\.tourbook\2" />
			</mapper>

		</copy>

		<!--
		<echo message="copy archive into language fragments  />
		-->
		<copy todir="${language-fragments}" overwrite="true" verbose="false" includeemptydirs="false">

			<fileset dir="${temp-unzip-dir}" includes="**/*">

				<!-- ignore empty files -->
				<size value="0" when="more" />
			</fileset>

			<mapper>
				<regexpmapper from="^(.*)\\src\\(de\.byteholder[^\\]*)(.*)$$" to="\\\2\.nl_${archive-language}\3" />
				<regexpmapper from="^(.*)\\src\\(net\.tourbook[^\\]*)(.*)$$" to="\\\2\.nl_${archive-language}\3" />
			</mapper>

		</copy>

	</target>

</project>
