<?xml version="1.0" encoding="UTF-8"?>

<project name="create-translation-file" default="create-all-archives" basedir="..">

	<!--
		create archive files with translatable property files
	-->

	<property name="mt-trunk" value=".." />

	<property name="archive-export-dir" value="${basedir}/translations/export" />
	<property name="archive-file-name" value="${archive-export-dir}/mt-translation" />
	<property name="archive-file-ext" value="zip" />

	<property name="temp-dir" value="${mt-trunk}/../ant-temp" />
	<property name="empty-files-dir" value="${temp-dir}/empty-files" />
	<property name="language-files-dir" value="${temp-dir}/language-files" />

	<!--
		DEFAULT target
	-->
	<target name="create-all-archives">

		<!-- delete all existing archives -->
		<delete>
			<fileset dir="${archive-export-dir}" />
		</delete>

		<!-- clear temp folder -->
		<echo message="delete temp dir: ${temp-dir}" />
		<delete dir="${temp-dir}" />

		<!-- create empty language files -->
		<antcall target="create-empty-files" />


		<!-- create archive: EN -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="" />
			<param name="file-language" value="" />
			<param name="archive-language" value="_en" />
		</antcall>

		<!-- create archive: DE -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="_de" />
			<param name="file-language" value="_de" />
			<param name="archive-language" value="_de" />
		</antcall>

		<!-- create archive: FR -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="_fr" />
			<param name="file-language" value="_fr" />
			<param name="archive-language" value="_fr" />
		</antcall>

		<!-- create archive: NL -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="_nl" />
			<param name="file-language" value="_nl" />
			<param name="archive-language" value="_nl" />
		</antcall>


		<!-- clear temp folder -->
		<echo message="delete temp dir: ${temp-dir}" />
		<delete dir="${temp-dir}" />

	</target>

	<!--
		DEBUG target
	-->
	<target name="debug">


	</target>

	<!--
		create empty language files 
	-->
	<target name="create-empty-files">

		<echo message="create empty language files: ${empty-files-dir}" />

		<echo message="copy english text files" />
		<copy todir="${empty-files-dir}">
			<fileset dir="${mt-trunk}">
				<include name="**/plugin.properties" />
				<include name="**/src/**/messages.properties" />
				<exclude name="**/bin/**" />
			</fileset>
		</copy>

		<echo message="truncate english text files" />
		<truncate>
			<fileset dir="${empty-files-dir}" />
		</truncate>

	</target>


	<target name="create-archive-for-one-language">

		<property name="archive-filepath" value="${archive-file-name}${archive-language}.${archive-file-ext}" />
		<echo message="create archive: ${archive-filepath}" />

		<echo message="delete old language files ${language-files-dir}" />
		<delete dir="${language-files-dir}" />

		<echo message="copy empty language files to ${language-files-dir}" />
		<copy todir="${language-files-dir}">
			<fileset dir="${empty-files-dir}" />
		</copy>

		<echo message="rename empty language files to ${file-language} in ${language-files-dir}" />
		<move todir="${language-files-dir}">
			<fileset dir="${language-files-dir}" />
			<regexpmapper from="^(.*)\.properties$$" to="\1${file-language}.properties" />
		</move>

		<echo message="overwrite language files to ${language-files-dir}" />
		<copy todir="${language-files-dir}" overwrite="true">
			<fileset dir="${mt-trunk}">
				<include name="**/plugin${search-language}.properties" />
				<include name="**/src/**/messages${search-language}.properties" />
				<exclude name="**/bin/**" />
			</fileset>
		</copy>

		<echo message="create language archive ${archive-filepath} in ${language-files-dir}" />
		<zip destfile="${archive-filepath}">
			<fileset dir="${language-files-dir}" />
		</zip>

	</target>

</project>
