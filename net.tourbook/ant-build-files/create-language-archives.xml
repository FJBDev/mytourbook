<?xml version="1.0" encoding="UTF-8"?>

<project name="create-translation-file" default="create-all-archives" basedir="..">

	<!--
		create archive files with translatable property files
	-->

	<property name="mt-trunk" value=".." />

	<property name="archive-export-folder" value="${basedir}/translations/export" />
	<property name="archive-file" value="${archive-export-folder}/mt-translation" />
	<property name="archive-file-ext" value="zip" />

	<property name="temp-dir" value="${mt-trunk}/../ant-temp" />
	<property name="empty-files-dir" value="${temp-dir}/empty-files" />
	<property name="language-files-dir" value="${temp-dir}/language-files" />

	<!--
		DEFAULT target
	-->
	<target name="create-all-archives">

		<!-- delete all existing archives -->
		<delete>
			<fileset dir="${archive-export-folder}" includes="**/*" />
		</delete>

		<!-- create archive: EN -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="" />
			<param name="archive-language" value="_en" />
		</antcall>

		<!-- create archive: DE -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="_de" />
			<param name="archive-language" value="_de" />
		</antcall>

		<!-- create archive: FR -->
		<antcall target="create-archive-for-one-language">
			<param name="search-language" value="_fr" />
			<param name="archive-language" value="_fr" />
		</antcall>

	</target>

	<!--
		DEBUG target
	-->
	<target name="debug">

		<!-- clear temp folder -->
		<echo message="delete temp dir: ${temp-dir}" />
		<delete>
			<fileset dir="${temp-dir}" includes="**/*" />
		</delete>

		<!-- create empty language files -->
		<antcall target="create-empty-files" />

		<!-- create archive: FR -->
		<antcall target="create-archive-for-one-language">
			<param name="archive-language" value="_fr" />
			<param name="search-language" value="_fr" />
		</antcall>


		<!-- clear temp folder
		<echo message="delete temp dir: ${temp-dir}" />
		<delete>
			<fileset dir="${temp-dir}" includes="**/*" />
		</delete>
		 -->

	</target>

	<!--
		create empty language files 
	-->
	<target name="create-empty-files">

		<echo message="create empty language files: ${empty-files-dir}" />

		<echo message="copy english text files" />
		<copy todir="${empty-files-dir}">
			<fileset dir="${mt-trunk}">
				<include name="**/plugin.properties" />
				<include name="**/src/**/messages.properties" />
				<exclude name="**/bin/**" />
			</fileset>
		</copy>

		<echo message="truncate english text files" />
		<truncate>
			<fileset dir="${empty-files-dir}" />
		</truncate>

	</target>


	<target name="create-archive-for-one-language">

		<property name="archive-filepath" value="${archive-file}${archive-language}.${archive-file-ext}" />
		<echo message="create archive: ${archive-filepath}" />

		<echo message="copy empty language files to ${language-files-dir}" />
		<copy todir="${language-files-dir}">
			<fileset dir="${empty-files-dir}" />
		</copy>

		<echo message="rename empty language files" />
		<move todir="${language-files-dir}">
			<fileset dir="${language-files-dir}" />
			<mapper type="glob" from="*.properties" to="*${archive-language}.properties" />
		</move>

		<echo message="overwrite language files to ${language-files-dir}" />
		<copy todir="${language-files-dir}" overwrite="true">
			<fileset dir="${mt-trunk}">
				<include name="**/plugin${search-language}.properties" />
				<include name="**/src/**/messages${search-language}.properties" />
				<exclude name="**/bin/**" />
			</fileset>
		</copy>

		<echo message="create archive from language files in ${language-files-dir}" />
		<zip destfile="${archive-filepath}">
			<fileset dir="${language-files-dir}" />
		</zip>

	</target>

	<target name="create-archive-with-one-language-OLD">

		<property name="archive-filepath" value="${archive-file}${archive-language}.${archive-file-ext}" />

		<echo message="create archive: ${archive-filepath}" />

		<zip destfile="${archive-filepath}">
			<fileset dir="${mt-trunk}" id="fileset-language">
				<include name="**/plugin${search-language}.properties" />
				<include name="**/src/**/messages${search-language}.properties" />
				<exclude name="**/bin/**" />
			</fileset>
		</zip>

	</target>


</project>
